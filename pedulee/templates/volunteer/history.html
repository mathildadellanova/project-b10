{% extends 'base.html' %}

{% load static %}

{% block meta %}
    <title>Projects</title>
{% endblock meta %}

{% block styles %}
<style>
    body {
        font-family: "Montserrat";
        text-align: center;
        background-image: url("{% static 'images/background.png' %}");
        background-size: cover;
        background-repeat: no-repeat;
        background-attachment: fixed;
    }
    .delete-button{
        font-weight:bold;
        background-color:#F96666;
        border: none;
        text-decoration: none;
        display: inline-block;
    }
</style>
{% endblock styles %}

{% block content %}
{% include '_components\navbar.html' %}

  <table style="text-align: center" class="table table-striped">
    <thead>
      <tr style="background-color: transparent">
        <th>Project Name</th>
        <th>Division</th>
        <th>Duration</th>
        <th>Cancel</th>
      </tr>
    </thead>

    <tbody id="data">
    </tbody>
    <tfoot>
        <template>
        <tr>
            <td>${item.fields.cloth_model}</td>
            <td>${item.fields.material}</td>
            <td>${item.fields.type}</td>
            <td>
                <button class="delete-button"
                    onmouseover="this.style.backgroundColor='#E14D2A';"
                    onmouseout="this.style.backgroundColor='#F96666';"
                    onclick="cancelVolunteer(0)">X</button>
            </td>
        </tr>
        </template>
    </tfoot>
  </table>
  {% include '_components\footer.html' %}
{% endblock content %}

{% block scripts %}
<script>
    const template = document.getElementsByTagName('template')[0];

    function getVolunteers() {
      return fetch("{% url 'pedulee:show_json_volunteer' %}").then((res) => {
        return res.json()
      })
    }

    async function refreshVolunteers() {
        const volunteers = await getVolunteers()
        const table =  document.getElementById("data");
        table.innerHTML = "";
        volunteers.forEach((item) => {
            const duplicate = template.cloneNode(true).content
            /** @type {HTMLElement[]} */
            const fields = duplicate.querySelectorAll('td')
            fields[0].innerHTML = item.title
            fields[1].innerHTML = item.divisi
            fields[2].innerHTML = item.amount
            fields[3].innerHTML = `<button class="delete-button"
                    onmouseover="this.style.backgroundColor='#E14D2A';"
                    onmouseout="this.style.backgroundColor='#F96666';"
                    onclick="cancelVolunteer(${item.id})">X</button>`
            table.appendChild(duplicate)
        })
    }

    function cancelVolunteer(id) {
        $.ajax({
            url: `volunteer/${id}/delete`,
            type: "DELETE",
            success: function() {
              $(`#${id}`).remove();
            }
        }).then(refreshVolunteers)
    }

    refreshVolunteers()
</script>
{% endblock scripts %}